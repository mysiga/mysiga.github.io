<!DOCTYPE html>
<html lang="cn">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Wilson" />


    
    


<meta name="description" content="每周分享博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Wilson">
<meta property="og:url" content="mysiga.cn/index.html">
<meta property="og:site_name" content="Wilson">
<meta property="og:description" content="每周分享博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wilson">
<meta name="twitter:description" content="每周分享博客">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Wilson" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Wilson</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Wilson</a></h1>
        </hgroup>

        
        <p class="header-subtitle">爱折腾的技术男</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" href="https://github.com/mysiga" title="GitHub"></a>
                            
                                <a class="fa 简书" href="http://www.jianshu.com/u/5fccc924116b" title="简书"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tablayout/">tablayout</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/同步异步/">同步异步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/坑/">坑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发效率/">开发效率</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/效率/">效率</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/研发杂谈/">研发杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动组周分享/">移动组周分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/线程/">线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网站/">网站</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://zhipingyang.github.io/">zhipingyang</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.tomatopeter.com/">阿潘</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.jianshu.com/u/d6f6c875ad03">zvving</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.jianshu.com/u/ac4f127d5150">xpleemoon</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.jianshu.com/users/iNXuJG/timeline">冰雪八哥</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.jinwong001.com/">Jinwong</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://wangsheng.github.io/">Victor</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://origheart.com/">Origheart</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://ckjava.com/">ck</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://prettychaoyao.github.io/">prettychaoyao</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Wilson</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Wilson</a></h1>
            </hgroup>
            
            <p class="header-subtitle">爱折腾的技术男</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/mysiga" title="GitHub"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/u/5fccc924116b" title="简书"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-Java线程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/08/03/Java线程/" class="article-date">
      <time datetime="2018-08-02T18:30:00.000Z" itemprop="datePublished">2018-08-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/03/Java线程/">深入Java线程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>线程是系统调度的最小单元，一个进程可以包含多个线程，作为任务的真正运作者，有自己的栈（Stack）、寄存器（Register）、本地存储（Thread Local）等，但是会和进程内其他线程共享文件描述符、虚拟地址空间等。在具体实现中，线程还分为内核线程、用户线程，Java 的线程实现其实是与虚拟机相关的。</p>
<h3 id="创建线程方式"><a href="#创建线程方式" class="headerlink" title="创建线程方式"></a>创建线程方式</h3><ul>
<li>继承Thread</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ThreadImpl</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>实现Runable</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyThread</span> <span class="title">implements</span> <span class="title">Runnable</span> &#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket;</div><div class="line">    <span class="keyword">private</span> Lock <span class="keyword">lock</span> = <span class="keyword">new</span> ReentrantLock();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span>(<span class="params"><span class="keyword">int</span> ticket</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.ticket = ticket;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(<span class="params"></span>) &#123;</div><div class="line">        print();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">lock</span>.<span class="keyword">lock</span>();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">while</span> (ticket &gt; <span class="number">0</span>) &#123;</div><div class="line">                System.<span class="keyword">out</span>.println(<span class="string">"ticket=="</span> + ticket);</div><div class="line">                ticket--;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">"Exception=="</span> + e);</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">lock</span>.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</div><div class="line">        MyThread myThread = <span class="keyword">new</span> MyThread(<span class="number">5</span>);</div><div class="line">        <span class="keyword">new</span> Thread(myThread).start();</div><div class="line">        <span class="keyword">new</span> Thread(myThread).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>实现Callable，运行完成后可返回值。</li>
</ul>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallTask</span> <span class="keyword">implements</span> <span class="title">Callable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> upperBounds;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> CallTask(<span class="keyword">int</span> upperBounds) &#123;</div><div class="line">        <span class="keyword">this</span>.upperBounds = upperBounds;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> Integer call() throws Exception &#123;</div><div class="line">        <span class="keyword">int</span> <span class="keyword">sum</span> = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= upperBounds; i++) &#123;</div><div class="line">            <span class="keyword">sum</span> += i;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">sum</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</div><div class="line">        ExecutorService service = Executors.newFixedThreadPool(<span class="number">10</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">int</span> <span class="keyword">sum</span> = (<span class="keyword">int</span>) service.submit(<span class="keyword">new</span> CallTask((<span class="keyword">int</span>) (Math.random() * <span class="number">100</span>))).get();</div><div class="line">            System.out.println(<span class="string">"sum=="</span> + <span class="keyword">sum</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="常用锁处理"><a href="#常用锁处理" class="headerlink" title="常用锁处理"></a>常用锁处理</h3><ul>
<li><a href="https://www.jianshu.com/p/d53bf830fa09" target="_blank" rel="external">synchronized</a>  </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;    </div><div class="line">  <span class="keyword">private</span> Integer key = <span class="number">0</span>;      </div><div class="line">  <span class="meta">@Override</span>    </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;       </div><div class="line">     <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;    </div><div class="line">        key++;          </div><div class="line">     System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + key);    </div><div class="line">    <span class="keyword">try</span> &#123;        </div><div class="line">        Thread.sleep(<span class="number">5</span>);   </div><div class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;        </div><div class="line">        e.printStackTrace();    &#125;</div><div class="line">      &#125;</div><div class="line">   &#125;    </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;       </div><div class="line"> LockThread lockThread = <span class="keyword">new</span> LockThread();       </div><div class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</div><div class="line">        <span class="keyword">new</span> Thread(lockThread, <span class="string">"thread"</span> + i).start();        </div><div class="line">    &#125;    </div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>lock</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LockThread</span> <span class="title">implements</span> <span class="title">Runnable</span> &#123;    </div><div class="line">  <span class="keyword">private</span> Integer key = <span class="number">0</span>;    </div><div class="line">  <span class="keyword">private</span> Lock <span class="keyword">lock</span> = <span class="keyword">new</span> ReentrantLock();    </div><div class="line">  @<span class="function">Override    </span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(<span class="params"></span>) &#123;       </div><div class="line">     <span class="keyword">lock</span>.<span class="keyword">lock</span>();  <span class="comment">//获取锁     </span></div><div class="line">       <span class="keyword">try</span> &#123;           </div><div class="line">           key++;                </div><div class="line">          System.<span class="keyword">out</span>.println(Thread.currentThread().getName() + <span class="string">":"</span> + key);            </div><div class="line">          Thread.sleep(<span class="number">5</span>);       </div><div class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;        </div><div class="line">        &#125; <span class="keyword">finally</span> &#123;            </div><div class="line">        <span class="keyword">lock</span>.unlock();  <span class="comment">//释放锁     </span></div><div class="line">       &#125;    </div><div class="line">     &#125;    </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;       </div><div class="line"> LockThread lockThread = <span class="keyword">new</span> LockThread();       </div><div class="line"> <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;            </div><div class="line">       <span class="keyword">new</span> Thread(lockThread, <span class="string">"thread"</span> + i).start();        </div><div class="line">      &#125;    </div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>volatile</li>
</ul>
<h3 id="volatile和synchronized的区别"><a href="#volatile和synchronized的区别" class="headerlink" title="volatile和synchronized的区别"></a>volatile和synchronized的区别</h3><table>
<thead>
<tr>
<th></th>
<th>volatile</th>
<th>synchronized</th>
</tr>
</thead>
<tbody>
<tr>
<td>作用域</td>
<td>变量</td>
<td>方法，代码块</td>
</tr>
<tr>
<td>操作性</td>
<td>仅保证可见性</td>
<td>可以保证可见性和原子性</td>
</tr>
<tr>
<td>线程堵塞状态</td>
<td>不会造成线程的阻塞</td>
<td>可能会造成线程的阻塞</td>
</tr>
</tbody>
</table>
<h3 id="Lock和synchronized的区别"><a href="#Lock和synchronized的区别" class="headerlink" title="Lock和synchronized的区别"></a>Lock和synchronized的区别</h3><table>
<thead>
<tr>
<th></th>
<th>Lock</th>
<th>synchronized</th>
</tr>
</thead>
<tbody>
<tr>
<td>使用区别</td>
<td>类</td>
<td>关键字</td>
</tr>
<tr>
<td>作用域</td>
<td>代码块</td>
<td>代码块，方法</td>
</tr>
<tr>
<td>释放锁</td>
<td>需要finally()方法手动释放锁</td>
<td>执行完自动释放锁</td>
</tr>
<tr>
<td>锁类型</td>
<td>可重入,可判断,可公平（两者皆可）</td>
<td>可重入,不可中断,非公平</td>
</tr>
<tr>
<td>依托实现</td>
<td>Java代码控制</td>
<td>JVM执行</td>
</tr>
<tr>
<td>性能</td>
<td>高竞争场景中表现可能优于synchronized</td>
<td>在低竞争场景中表现可能优于 ReentrantLock</td>
</tr>
</tbody>
</table>
<h3 id="sleep-和wait-的区别"><a href="#sleep-和wait-的区别" class="headerlink" title="sleep()和wait()的区别"></a>sleep()和wait()的区别</h3><table>
<thead>
<tr>
<th></th>
<th>sleep</th>
<th>wait</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>睡眠时，保持对象锁，仍然占有该锁</td>
<td>睡眠时，释放对象锁</td>
</tr>
<tr>
<td>作用域</td>
<td>任何地方调用</td>
<td>只能在同步方法或同步块中使用</td>
</tr>
<tr>
<td>时间</td>
<td>指定时间后唤醒</td>
<td>只有等notify()/notifyAll()通知有才能唤醒</td>
</tr>
</tbody>
</table>
<h3 id="并发高效类"><a href="#并发高效类" class="headerlink" title="并发高效类"></a>并发高效类</h3><p>实际开发中Java封装了一些解决高并发的类包（java.util.concurrent包），常用的如下：</p>
<ul>
<li>AtomicInteger：提供一种线程安全的加减操作</li>
<li>AtomicBoolean</li>
<li>AtomicLong</li>
<li>AtomicReference</li>
<li>AtomicIntegerArray</li>
<li>AtomicLongArray</li>
<li>AtomicReferenceArray</li>
</ul>
<h3 id="线程生命周期"><a href="#线程生命周期" class="headerlink" title="线程生命周期"></a>线程生命周期</h3><p><img src="https://upload-images.jianshu.io/upload_images/1534431-8837ea32b7cd19b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="线程生命周期"></p>
<p>关于线程生命周期的不同状态，在 Java 5 以后，线程状态被明确定义在其公共内部枚举类型 java.lang.Thread.State 中，分别是：</p>
<ul>
<li>新建（NEW），表示线程被创建出来还没真正启动的状态，可以认为它是个 Java 内部状态。</li>
<li>就绪（RUNNABLE），表示该线程已经在 JVM 中执行，当然由于执行需要计算资源，它可能是正在运行，也可能还在等待系统分配给它 CPU 片段，在就绪队列里面排队。<br>在其他一些分析中，会额外区分一种状态 RUNNING，但是从 Java API 的角度，并不能表示出来。</li>
<li>阻塞（BLOCKED），这个状态和我们前面两讲介绍的同步非常相关，阻塞表示线程在等待 Monitor lock。比如，线程试图通过 synchronized 去获取某个锁，但是其他线程已经独占了，那么当前线程就会处于阻塞状态。如：sleep()</li>
<li>等待（WAITING），表示正在等待其他线程采取某些操作。一个常见的场景是类似生产者消费者模式，发现任务条件尚未满足，就让当前消费者线程等待（wait），另外的生产者线程去准备任务数据，然后通过类似 notify 等动作，通知消费线程可以继续工作了。Thread.join() 也会令线程进入等待状态。</li>
<li>计时等待（TIMED_WAIT），其进入条件和等待状态类似，但是调用的是存在超时条件的方法，比如 wait 或 join 等方法的指定超时版本，如下面示例：</li>
</ul>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="function"><span class="keyword">void</span> <span class="title">wait</span><span class="params">(<span class="keyword">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException</span>;</div></pre></td></tr></table></figure>
<ul>
<li>终止（TERMINATED），不管是意外退出还是正常执行结束，线程已经完成使命，终止运行，也有人把这个状态叫作死亡。<br>在第二次调用 start() 方法的时候，线程可能处于终止或者其他（非 NEW）状态，但是不论如何，都是不可以再次启动的。</li>
</ul>
<h3 id="线程安全基本特性"><a href="#线程安全基本特性" class="headerlink" title="线程安全基本特性"></a>线程安全基本特性</h3><ul>
<li>原子性：简单说就是相关操作不会中途被其他线程干扰，一般通过同步机制实现</li>
<li>可见性:是一个线程修改了某个共享变量，其状态能够立即被其他线程知晓，通常被解释为将线程本地状态反映到主内存上，volatile就是负责保证可见性的。<ul>
<li>有序性，是保证线程内串行语义，避免指令重排等</li>
</ul>
</li>
</ul>
<h3 id="Monitor-实现的三种锁："><a href="#Monitor-实现的三种锁：" class="headerlink" title="Monitor 实现的三种锁："></a>Monitor 实现的三种锁：</h3><p>所谓锁的升级、降级，就是 JVM 优化 synchronized 运行的机制，当 JVM 检测到不同的竞争状况时，会自动切换到适合的锁实现，这种切换就是锁的升级、降级。</p>
<ul>
<li>偏斜锁（Biased Locking）<br>当没有竞争出现时，默认会使用偏斜锁。JVM 会利用 CAS 操作（compare and swap），在对象头上的 Mark Word 部分设置线程 ID，以表示这个对象偏向于当前线程，所以并不涉及真正的互斥锁。这样做的假设是基于在很多应用场景中，大部分对象生命周期中最多会被一个线程锁定，使用偏斜锁可以降低无竞争开销。</li>
<li>轻量级锁<br>如果有另外的线程试图锁定某个已经被偏斜过的对象，JVM 就需要撤销（revoke）偏斜锁，并切换到轻量级锁实现。</li>
<li>重量级锁<br>轻量级锁依赖 CAS 操作 Mark Word 来试图获取锁，如果重试成功，就使用普通的轻量级锁；否则，进一步升级为重量级锁。</li>
</ul>
<p>我注意到有的观点认为 Java 不会进行锁降级。实际上据我所知，锁降级确实是会发生的，当 JVM 进入安全点（SafePoint）的时候，会检查是否有闲置的 Monitor，然后试图进行降级<br><img src="https://upload-images.jianshu.io/upload_images/1534431-1816e7d12c4ed6c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>可重入锁：它是表示当一个线程试图获取一个它已经获取的锁时,这个获取动作就自动成功。<br>ReentrantLock和synchronized，</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RepeLock</span> <span class="title">implements</span> <span class="title">Runnable</span> &#123;</div><div class="line">    <span class="keyword">private</span> Lock <span class="keyword">lock</span> = <span class="keyword">new</span> ReentrantLock();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">lock</span>.<span class="keyword">lock</span>();</div><div class="line">            System.<span class="keyword">out</span>.println(Thread.currentThread().getId());</div><div class="line">            <span class="keyword">set</span>();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">lock</span>.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">lock</span>.<span class="keyword">lock</span>();</div><div class="line">            System.<span class="keyword">out</span>.println(Thread.currentThread().getId());</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">lock</span>.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(<span class="params"></span>) &#123;</div><div class="line">        <span class="keyword">get</span>();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</div><div class="line">        RepeLock repeLock = <span class="keyword">new</span> RepeLock();</div><div class="line">        <span class="keyword">new</span> Thread(repeLock).start();</div><div class="line">        <span class="keyword">new</span> Thread(repeLock).start();</div><div class="line">        <span class="keyword">new</span> Thread(repeLock).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>锁膨胀：</li>
<li>自旋锁：<br>线程去拿锁时发现已经有线程拿了锁，然后让线程去执行一个无意义的循环，循环结束后再去重新竞争锁，如果竞争不到继续循环，循环过程中线程会一直处于running状态，但是基于JVM的线程调度，会出让时间片，所以其他线程依旧有申请锁和释放锁的机会。自旋锁省去了阻塞锁的时间空间（队列的维护等）开销，但是长时间自旋就变成了“忙式等待”，忙式等待显然还不如阻塞锁。所以自旋的次数一般控制在一个范围内，例如10,100等，在超出这个范围后，自旋锁会升级为阻塞锁。</li>
<li><a href="https://www.cnblogs.com/chenyangyao/p/5269622.html" target="_blank" rel="external">指令重排</a></li>
</ul>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a><a href="https://mp.weixin.qq.com/s/eyFVplFcZoN6-4WTMojtMw" target="_blank" rel="external">线程池</a></h3><p>Executors 目前提供了 5 种不同的线程池创建配置：</p>
<ul>
<li>newCachedThreadPool()，它是一种用来处理大量短时间工作任务的线程池，具有几个鲜明特点：它会试图缓存线程并重用，当无缓存线程可用时，就会创建新的工作线程；如果线程闲置的时间超过 60 秒，则被终止并移出缓存；长时间闲置时，这种线程池，不会消耗什么资源。其内部使用 SynchronousQueue 作为工作队列。</li>
<li>newFixedThreadPool(int nThreads)，重用指定数目（nThreads）的线程，其背后使用的是无界的工作队列，任何时候最多有 nThreads 个工作线程是活动的。这意味着，如果任务数量超过了活动队列数目，将在工作队列中等待空闲线程出现；如果有工作线程退出，将会有新的工作线程被创建，以补足指定的数目 nThreads。</li>
<li>newSingleThreadExecutor()，它的特点在于工作线程数目被限制为 1，操作一个无界的工作队列，所以它保证了所有任务的都是被顺序执行，最多会有一个任务处于活动状态，并且不允许使用者改动线程池实例，因此可以避免其改变线程数目。</li>
<li>newSingleThreadScheduledExecutor() 和 newScheduledThreadPool(int corePoolSize)，创建的是个 ScheduledExecutorService，可以进行定时或周期性的工作调度，区别在于单一工作线程还是多个工作线程。</li>
<li>newWorkStealingPool(int parallelism)，这是一个经常被人忽略的线程池，Java 8 才加入这个创建方法，其内部会构建ForkJoinPool，利用Work-Stealing算法，并行地处理任务，不保证处理顺序。</li>
</ul>
<p>线程池构造方法几个参数</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></div><div class="line">                              <span class="keyword">int</span> maximumPoolSize,</div><div class="line">                              <span class="keyword">long</span> keepAliveTime,</div><div class="line">                              TimeUnit unit,</div><div class="line">                              BlockingQueue&lt;Runnable&gt; workQueue,</div><div class="line">                              ThreadFactory threadFactory,</div><div class="line">                              RejectedExecutionHandler <span class="keyword">handler</span>) &#123;</div></pre></td></tr></table></figure>
<ol>
<li>corePoolSize : 该线程池中核心线程数最大值<br>核心线程：线程池新建线程的时候，如果当前线程总数小于 corePoolSize ，则新建的是核心线程；如果超过corePoolSize，则新建的是非核心线程。核心线程默认情况下会一直存活在线程池中，即使这个核心线程啥也不干(闲置状态)。如果指定ThreadPoolExecutor的 allowCoreThreadTimeOut 这个属性为true，那么核心线程如果不干活(闲置状态)的话，超过一定时间( keepAliveTime)，就会被销毁掉.</li>
<li>maximumPoolSize ：该线程池中线程总数的最大值<br>线程总数计算公式 = 核心线程数 + 非核心线程数。</li>
<li>keepAliveTime  ：该线程池中非核心线程闲置超时时长<br>注意：一个非核心线程，如果不干活(闲置状态)的时长，超过这个参数所设定的时长，就会被销毁掉。但是，如果设置了  allowCoreThreadTimeOut = true，则会作用于核心线程。</li>
<li>unit ：（时间单位）<br>首先，TimeUnit是一个枚举类型，翻译过来就是时间单位，我们最常用的时间单位包括：<br>MILLISECONDS ： 1毫秒 、SECONDS ： 秒、MINUTES ： 分、HOURS ： 小时、DAYS ： 天</li>
<li>BlockingQueue<runnable> workQueue ：( Blocking：阻塞的，queue：队列)，主要有四种队列<ul>
<li>SynchronousQueue：（同步队列）这个队列接收到任务的时候，会直接提交给线程处理，而不保留它（名字定义为 同步队列），所有该队列跟设置的corePoolSize无效。但有一种情况，假设所有线程都在工作怎么办？这种情况下，SynchronousQueue就会新建一个线程来处理这个任务。所以为了保证不出现（线程数达到了maximumPoolSize而不能新建线程）的错误，使用这个类型队列的时候，maximumPoolSize一般指定成Integer.MAX_VALUE，即无限大，去规避这个使用风险。<ul>
<li>LinkedBlockingQueue（链表阻塞队列）：这个队列接收到任务的时候，如果当前线程数小于核心线程数，则新建线程(核心线程)处理任务；如果当前线程数等于核心线程数，则进入队列等待。由于这个队列没有最大值限制，即所有超过核心线程数的任务都将被添加到队列中，这也就导致了maximumPoolSize的设定失效，因为总线程数永远不会超过corePoolSize</li>
<li>ArrayBlockingQueue（数组阻塞队列）：可以限定队列的长度（既然是数组，那么就限定了大小），接收到任务的时候，如果没有达到corePoolSize的值，则新建线程(核心线程)执行任务，如果达到了，则入队等候，如果队列已满，则新建线程(非核心线程)执行任务，又如果总线程数到了maximumPoolSize，并且队列也满了，则发生错误</li>
<li>DelayQueue（延迟队列）：队列内元素必须实现Delayed接口，这就意味着你传进去的任务必须先实现Delayed接口。这个队列接收到任务时，首先先入队，只有达到了指定的延时时间，才会执行任务</li>
</ul>
</li>
</ul>
</runnable></li>
<li>ThreadFactory threadFactory = &gt; 创建线程的方式，这是一个接口，new它的时候需要实现他的Thread newThread(Runnable r)方法</li>
<li>RejectedExecutionHandler handler = &gt; 这个主要是用来抛异常的<br>当线程无法执行新任务时（一般是由于线程池中的线程数量已经达到最大数或者线程池关闭导致的），默认情况下，当线程池无法处理新线程时，会抛出一个RejectedExecutionException。</li>
</ol>
<p>以 LinkedBlockingQueue、ArrayBlockingQueue 和 SynchronousQueue 为例，我们一起来分析一下，根据需求可以从很多方面考量：</p>
<h3 id="ArrayBlockingQueue-LinkedBlockingQueue-SynchronousQueue"><a href="#ArrayBlockingQueue-LinkedBlockingQueue-SynchronousQueue" class="headerlink" title="ArrayBlockingQueue ,LinkedBlockingQueue ,SynchronousQueue"></a>ArrayBlockingQueue ,LinkedBlockingQueue ,SynchronousQueue</h3><ul>
<li>从空间利用角度，数组结构的 ArrayBlockingQueue 要比 LinkedBlockingQueue 紧凑，因为其不需要创建所谓节点，但是其初始分配阶段就需要一段连续的空间，所以初始内存需求更大。</li>
<li>通用场景中，LinkedBlockingQueue 的吞吐量一般优于 ArrayBlockingQueue，因为它实现了更加细粒度的锁操作。</li>
<li>ArrayBlockingQueue 实现比较简单，性能更好预测，属于表现稳定的“选手”。</li>
<li>如果我们需要实现的是两个线程之间接力性（handoff）的场景，按照专栏上一讲的例子，你可能会选择 CountDownLatch，但是SynchronousQueue也是完美符合这种场景的，而且线程间协调和数据传输统一起来，代码更加规范。</li>
<li>可能令人意外的是，很多时候 SynchronousQueue 的性能表现，往往大大超过其他实现，尤其是在队列元素较小的场景。</li>
</ul>
<h3 id="重点源码分享"><a href="#重点源码分享" class="headerlink" title="重点源码分享"></a>重点源码分享</h3><p>okhttp</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="function">ExecutorService <span class="title">executorService</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (executorService == <span class="keyword">null</span>) &#123;</div><div class="line">     executorService = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS,</div><div class="line">         <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;(), Util.threadFactory(<span class="string">"OkHttp Dispatcher"</span>, <span class="keyword">false</span>));</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> executorService;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> enqueue(AsyncCall <span class="keyword">call</span>) &#123;</div><div class="line">   <span class="keyword">if</span> (runningAsyncCalls.<span class="keyword">size</span>() &lt; maxRequests &amp;&amp; runningCallsForHost(<span class="keyword">call</span>) &lt; maxRequestsPerHost) &#123;</div><div class="line">     runningAsyncCalls.add(<span class="keyword">call</span>);</div><div class="line">     executorService().execute(<span class="keyword">call</span>);</div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">     readyAsyncCalls.add(<span class="keyword">call</span>);</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>AsyncTask</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">private<span class="keyword"> static</span><span class="keyword"> final</span> BlockingQueue&lt;Runnable&gt; sPoolWorkQueue =</div><div class="line">          <span class="built_in"> new </span>LinkedBlockingQueue&lt;Runnable&gt;(128);</div><div class="line">   /**</div><div class="line">    * An &#123;@link Executor&#125; that can be used to<span class="built_in"> execute </span>tasks in parallel.</div><div class="line">    */</div><div class="line">  <span class="keyword"> public</span><span class="keyword"> static</span><span class="keyword"> final</span> Executor THREAD_POO<span class="class">L_EXECUTOR;</span></div><div class="line">  <span class="keyword"> static</span> &#123;</div><div class="line">       ThreadPoolExecutor threadPoolExecutor =<span class="built_in"> new </span>ThreadPoolExecutor(</div><div class="line">               CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,</div><div class="line">               sPoolWorkQueue, sThreadFactory);</div><div class="line">       threadPoolExecutor.allowCoreThreadTimeOut(true);</div><div class="line">       THREAD_POO<span class="class">L_EXECUTOR = threadPoolExecutor;</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> ArrayDeque&lt;Runnable&gt; mTasks = <span class="keyword">new</span> ArrayDeque&lt;Runnable&gt;();</div><div class="line">        Runnable mActive;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">final</span> Runnable r)</span> </span>&#123;</div><div class="line">            mTasks.offer(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        r.run();</div><div class="line">                    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                        scheduleNext();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">if</span> (mActive == <span class="keyword">null</span>) &#123;</div><div class="line">                scheduleNext();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">scheduleNext</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> ((mActive = mTasks.poll()) != <span class="keyword">null</span>) &#123;</div><div class="line">                THREAD_POOL_EXECUTOR.execute(mActive);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Java/">Java</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Java异常" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/17/Java异常/" class="article-date">
      <time datetime="2018-07-16T18:30:00.000Z" itemprop="datePublished">2018-07-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/17/Java异常/">Java异常</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Java异常"><a href="#Java异常" class="headerlink" title="Java异常"></a>Java异常</h2><p><img src="https://upload-images.jianshu.io/upload_images/1534431-11903c56d9e318ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Java异常"></p>
<ul>
<li>对比Exception和Error </li>
<li>运行异常与一般异常区别</li>
<li>ClassNotFoundException和NoClassDefFoundError有什么区别</li>
<li>throw和throws</li>
<li>异常处理几点建议</li>
<li>自定义异常<br>###对比Exception和Error。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-ad557fa71b48a3ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Exception和Error"><br>Exception和Error都继承Throwable,</li>
<li>Exception是程序可以处理的异常，正常JVM运行外的异常。</li>
<li>Error一般是JVM相关异常错误，不可恢复状态，也不方便捕获。<br>###运行异常与一般异常区别<br>Eeception又分为可检测异常（Checked Exception）和运行异常（也可叫不可检查异常，Runtime Exception）。</li>
<li>可检查异常（Checked Exception）在代码里必须显式地进行捕获处理，可以被处理的异常。如：IOException。</li>
<li>运行异常,类似NullPointerException,ArrayIndexOutOfBoundsException,通常是可以编码避免的逻辑错误，具体根据需要来判断是否需要捕获，并不会在编译器强制要求。<br>###ClassNotFoundException和NoClassDefFoundError有什么区别</li>
<li>ClassNotFoundException:Java动态加载类的时候，如果这个类在类路径中没有被找到或者当一个类已经某个类加载器加载到内存中了，此时另一个类加载器又尝试着动态地从同一个包中加载这个类就会抛出ClassNotFoundException异常。类加载中加载时从外存储器找不到需要的class。</li>
<li><p>NoClassDefFoudError，指要查找的类在编译的时候是存在的，运行的时候却找不到的异常错误。类加载中连接时从内存找不到需要的class。<br>###throw和throws</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">custormException</span><span class="params">()</span><span class="keyword">throws</span>  CustomException</span>&#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> CustomException(<span class="string">"抛出CustormException"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>throw作用域方法体内</p>
</li>
<li>throws方法名后面<br>###异常处理几点建议</li>
<li><p>只针对不正常的情况才使用异常,不需要异常处理的不要专门处理以增加系统额外检查降低性能。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">arr[i]=<span class="number">0</span>;</div><div class="line">i++;</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>抛出的异常要适合于相应的抽象</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> E get(<span class="keyword">int</span> <span class="keyword">index</span>) &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="keyword">return</span> listIterator(<span class="keyword">index</span>).next();</div><div class="line">&#125; <span class="keyword">catch</span> (NoSuchElementException exc) &#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span>+<span class="keyword">index</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>不要忽略异常，避免使用空的catch语句</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">...</div><div class="line">&#125; <span class="keyword">catch</span> (SomeException e) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>异常保证输出堆栈信息，在异常消息中加入导致异常发生的全部信息</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">...</div><div class="line">&#125; <span class="keyword">catch</span> (SomeException e) &#123;</div><div class="line">System.out.println(<span class="string">"12344"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>###自定义异常<br>一般根据项目需要自定义异常，特别是服务端处理业务的时候。一般自定义异常继承Exception，Throwable（因为Error一般用于JVM的异常错误，不常用自定义），因为异常已实现相关方法，只需重写构造方法就可以。代码如下：</p>
<ul>
<li>继承Exception<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">()</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(message);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message, Throwable cause)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(message, cause);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(Throwable cause)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(cause);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message, Throwable cause, <span class="keyword">boolean</span> enableSuppression, <span class="keyword">boolean</span> writableStackTrace)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(message, cause, enableSuppression, writableStackTrace);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestException</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span></span>&#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">custormException();</div><div class="line">&#125; <span class="keyword">catch</span> (CustomException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">custormException</span><span class="params">()</span><span class="keyword">throws</span>  CustomException</span>&#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> CustomException(<span class="string">"抛出CustormException"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">TestException testException=<span class="keyword">new</span> TestException();</div><div class="line">testException.testMethod();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.CustomException</span>: 抛出CustormException</div><div class="line">at com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.TestException</span><span class="selector-class">.custormException</span>(TestException<span class="selector-class">.java</span>:<span class="number">15</span>)</div><div class="line">at com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.TestException</span><span class="selector-class">.testMethod</span>(TestException<span class="selector-class">.java</span>:<span class="number">9</span>)</div><div class="line">at com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.TestException</span><span class="selector-class">.main</span>(TestException<span class="selector-class">.java</span>:<span class="number">19</span>)</div></pre></td></tr></table></figure></p>
<ul>
<li>继承Throwable<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomThrowable</span> <span class="keyword">extends</span> <span class="title">Throwable</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomThrowable</span><span class="params">()</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomThrowable</span><span class="params">(String message)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(message);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomThrowable</span><span class="params">(String message, Throwable cause)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(message, cause);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomThrowable</span><span class="params">(Throwable cause)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(cause);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">CustomThrowable</span><span class="params">(String message, Throwable cause, <span class="keyword">boolean</span> enableSuppression, <span class="keyword">boolean</span> writableStackTrace)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(message, cause, enableSuppression, writableStackTrace);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThrowable</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span></span>&#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">custormException();</div><div class="line">&#125; <span class="keyword">catch</span> (CustomThrowable e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">custormException</span><span class="params">()</span><span class="keyword">throws</span>  CustomThrowable</span>&#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> CustomThrowable(<span class="string">"抛出CustomThrowable"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">TestThrowable testThrowable=<span class="keyword">new</span> TestThrowable();</div><div class="line">testThrowable.testMethod();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.CustomThrowable</span>: 抛出CustomThrowable</div><div class="line">at com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.TestThrowable</span><span class="selector-class">.custormException</span>(TestThrowable<span class="selector-class">.java</span>:<span class="number">15</span>)</div><div class="line">at com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.TestThrowable</span><span class="selector-class">.testMethod</span>(TestThrowable<span class="selector-class">.java</span>:<span class="number">9</span>)</div><div class="line">at com<span class="selector-class">.mysiga</span><span class="selector-class">.learn</span><span class="selector-class">.throwable</span><span class="selector-class">.TestThrowable</span><span class="selector-class">.main</span>(TestThrowable<span class="selector-class">.java</span>:<span class="number">19</span>)</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Java/">Java</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Java垃圾回收机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/12/Java垃圾回收机制/" class="article-date">
      <time datetime="2018-07-12T11:11:00.000Z" itemprop="datePublished">2018-07-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/12/Java垃圾回收机制/">我所知道的-Java垃圾回收机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><img src="https://upload-images.jianshu.io/upload_images/1534431-a4831eb7feafd902.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Java垃圾回收机制"></p>
<p>本文章你能知道的内容：</p>
<ul>
<li>Java内存模型</li>
<li>Java堆</li>
<li>对象什么时候回收</li>
<li>垃圾回收算法</li>
<li>垃圾回收器<h3 id="Java内存模型"><a href="#Java内存模型" class="headerlink" title="Java内存模型"></a>Java内存模型</h3>要了解Java垃圾回收机制，首先知道Java内存模型是怎么样的。如下图<br><img src="https://upload-images.jianshu.io/upload_images/1534431-2c69d083add54ae6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Java内存模型"><ul>
<li>程序计数器</li>
<li>Java 虚拟机栈</li>
<li>方法区：方法区也是各个线程共享的内存区域，它用于存储已经被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据</li>
</ul>
</li>
<li>运行时常量池<ul>
<li>Java 堆:一般new的对象实例和数组都是在堆中的，而GC主要回收的内存也是这块堆内存，后面单独领出来来讲。</li>
<li>直接内存：不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范定义的内存区域(Fresco图片加载库，就是运行这块内存超越虚拟机内存使用)。</li>
<li>code cache等其他内存<h3 id="Java-堆"><a href="#Java-堆" class="headerlink" title="Java 堆"></a>Java 堆</h3>Java Heap 是 Java 虚拟机所管理的内存中最大的一块，它是所有线程共享的一块内存区域。几乎所有的对象实例和数组都在这类分配内存。<blockquote>
<p>Java 堆内存由垃圾回收器的自动内存管理系统管理。<br>堆内存分为两大部分：新生代和老年代，默认比例为1：2，可修改。<br>老年代主要存放应用程序中生命周期长的存活对象。<br>新生代又分为三个部分：一个Eden区和两个Survivor区，默认比例为8：1：1，可修改。<br>Eden区存放新生的对象。<br>Survivor存放每次垃圾回收后存活的对象。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-062a3348d8286a11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="堆内存"></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="为什么？"><a href="#为什么？" class="headerlink" title="为什么？"></a>为什么？</h3><ul>
<li>为什么要分新生代和老年代？</li>
<li>新生代为什么分一个Eden区和两个Survivor区?</li>
</ul>
<p>带着这些疑问，我们就要先了解堆相关的垃圾回收算法和采用的垃圾回收器。在讲算法前先了解怎么判断对象是否回收。</p>
<h3 id="对象什么时候回收？"><a href="#对象什么时候回收？" class="headerlink" title="对象什么时候回收？"></a>对象什么时候回收？</h3><p>判断对象是否回收主要有以下两种算法</p>
<ul>
<li>引用计数算法<br>给对象中添加一个引用计数器，每当有一个地方引用它时，计数器值就加1；当引用失效时，计数器值就减1；任何时刻计数器为0的对象就是不可能再被使用的。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-982627fe64dfa349.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="引用计数算法"><ul>
<li>优点：简单，高效，Objective-c用的就是这种算法。</li>
<li>缺点：很难处理循环引用，比如图中相互引用的两个对象则无法释放。但是也有解决办法，想知道自行搜索。</li>
</ul>
</li>
<li>可达性分析算法（根搜索算法）<br>为了解决上面的循环引用问题，Java采用了一种新的算法：可达性分析算法。<br>从GC Roots（每种具体实现对GC Roots有不同的定义）作为起点，向下搜索它们引用的对象，可以生成一棵引用树，树的节点视为可达对象，反之视为不可达。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-a9dda2d42cd749cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="可达性分析算法"><blockquote>
<p>Java定义的GC Roots对象:<br>虚拟机栈（帧栈中的本地变量表）中引用的对象。<br>方法区中静态属性引用的对象。<br>方法区中常量引用的对象。<br>本地方法栈中JNI引用的对象。</p>
</blockquote>
</li>
</ul>
<p>如果出现循环引用了，只要没有被GC Roots引用了就会被回收，完美解决！</p>
<h3 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><p>知道了什么时候回收对象，那我们再看具体怎么垃圾回收。</p>
<ul>
<li>标记清除法<br>标记-清除法分为两个阶段：标记阶段和清除阶段。标记阶段的任务是标记出所有需要被回收的对象，清除阶段就是回收被标记的对象所占用的空间。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-43bc311c23427d67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标记清除法"><ul>
<li>优点：是简单，容易实现。</li>
<li>缺点：容易产生内存碎片，碎片太多可能会导致后续过程中需要为大对象分配空间时无法找到足够的空间而提前触发新的一次垃圾收集动作。</li>
</ul>
</li>
<li><p>复制算法<br>复制算法将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用的内存空间一次清理掉，这样一来就不容易出现内存碎片的问题。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-9bf508a2e534d864.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="复制算法"></p>
<ul>
<li>优点：实现简单，运行高效且不容易产生内存碎片，适用于存活对象很少。回收对象多</li>
<li>缺点：内存空间的使用做出了高昂的代价，因为能够使用的内存缩减到原来的一半，如果存活对象很多，那么Copying算法的效率将会大大降低。</li>
</ul>
</li>
<li>标记整理算法<br>该算法标记阶段和标记清除法一样，但是在完成标记之后，它不是直接清理可回收对象，而是将存活对象都向一端移动，然后清理掉端边界以外的内存。<br><img src="https://upload-images.jianshu.io/upload_images/1534431-4b6066a7e03fb403.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标记整理算法"><ul>
<li>优点：不会出现内存碎片问题，适用于存活对象多，回收对象少的情况使用</li>
<li>缺点：整理时间长，容易导致卡顿。</li>
</ul>
</li>
<li>分代回收算法<br>分代回收算法其实不算一种新的算法，而是根据复制算法和标记整理算法的使用场景综合使用。<blockquote>
<p>复制算法：适用于存活对象很少。回收对象多<br>标记整理算法: 适用用于存活对象多，回收对象少</p>
</blockquote>
</li>
</ul>
<p>分代算法就是根据对象存活的生命周期将内存划分为若干个不同的区域。一般情况下将堆区划分为老年代（Old Generation）和新生代（Young Generation），老年代的特点是每次垃圾收集时只有少量对象需要被回收所以采用标记整理法。而新生代的特点是每次垃圾回收时都有大量的对象需要被回收所以采用复制算法（改良的复制算法，不是按1：1分配）。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1534431-df6da09763c72d95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="分代回收算法"></p>
<ul>
<li><p>Eden空间和两块Survivor空间的工作流程</p>
<blockquote>
<p>// 分配了一个又一个对象<br>放到Eden区<br>// 不好，Eden区满了，只能GC(新生代GC：Minor GC)了<br>把Eden区的存活对象copy到Survivor A区，然后清空Eden区（本来Survivor B区也需要清空的，不过本来就是空的）<br>// 又分配了一个又一个对象<br>放到Eden区<br>// 不好，Eden区又满了，只能GC(新生代GC：Minor GC)了<br>把Eden区和Survivor A区的存活对象copy到Survivor B区，然后清空Eden区和Survivor A区<br>// 又分配了一个又一个对象<br>放到Eden区<br>// 不好，Eden区又满了，只能GC(新生代GC：Minor GC)了<br>把Eden区和Survivor B区的存活对象copy到Survivor A区，然后清空Eden区和Survivor B区<br>// …<br>// 有的对象来回在Survivor A区或者B区呆了比如15次，就被分配到老年代Old区<br>// 有的对象太大，超过了Eden区，直接被分配在Old区<br>// 有的存活对象，放不下Survivor区，也被分配到Old区<br>// …<br>// 在某次Minor GC的过程中突然发现：<br>// 不好，老年代Old区也满了，这是一次大GC(老年代GC：Major GC)<br>Old区慢慢的整理一番，空间又够了<br>// 继续Minor GC<br>// …<br>// …<br>在回答上面提出的问题？<br>为什么要分新生代和老年代？<br>综合使用算法，最优采用分代算法所以分为新生代和老年代两块区域。具体为什么1：2？应该是根据实践测试得出的结果，也可以调整。</p>
</blockquote>
</li>
<li><p>回答第二个问题<a href="https://blog.csdn.net/antony9118/article/details/51425581" target="_blank" rel="external">为什么新生代内存需要有两个Survivor区</a>，这里讲的比较详细</p>
</li>
<li><p>什么时候触发GC？</p>
<blockquote>
<p>GC_FOR_MALLOC: 表示是在堆上分配对象时内存不足触发的GC。<br>GC_CONCURRENT: 当我们应用程序的堆内存达到一定量，或者可以理解为快要满的时候，系统会自动触发GC操作来释放内存。<br>GC_EXPLICIT: 表示是应用程序调用System.gc、VMRuntime.gc接口或者收到SIGUSR1信号时触发的GC。<br>GC_BEFORE_OOM: 表示是在准备抛OOM异常之前进行的最后努力而触发的GC。</p>
<h3 id="垃圾回收器"><a href="#垃圾回收器" class="headerlink" title="垃圾回收器"></a>垃圾回收器</h3><p>在GC机制中，起重要作用的是垃圾收集器，垃圾收集器是GC的具体实现，Java虚拟机规范中对于垃圾收集器没有任何规定，所以不同厂商实现的垃圾 收集器各不相同，也有可能采用多个垃圾回收器并存方式，HotSpot 1.6版使用的垃圾收集器如下图（图来源于《深入理解Java虚拟机：JVM高级特效与最佳实现》，图中两个收集器之间有连线，说明它们可以配合使用）<br><img src="https://upload-images.jianshu.io/upload_images/1534431-e50e3a7a84da379d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="垃圾回收器"></p>
</blockquote>
</li>
<li><p>Serial收集器</p>
</li>
<li>ParNew收集器</li>
<li>Parallel Scavenge收集器</li>
<li>CMS收集器（应用非常广泛）</li>
<li>G1收集器（面向服务端应用）<br>###ART与Dalvik虚拟机<br>ART(Android Runtime)是Android 4.4发布的，用来替换Dalvik虚拟，Android 4.4默认采用的还是DVM，系统会提供一个选项来开启ART。在Android 5.0时，默认采用ART，DVM从此退出历史舞台。</li>
</ul>
<p>ART与Dalvik的区别</p>
<ul>
<li>Dalvik中的应用每次运行时，字节码都需要通过即时编译器（JIT，just in time）转换为机器码，这会使得应用的运行效率降低。而在ART中，系统在安装应用时会进行一次预编译（AOT，ahead of time）,将字节码预先编译成机器码并存储在本地，这样应用每次运行时就不需要执行编译了，运行效率也大大提升。</li>
<li>ART占用空间比Dalvik大（字节码变为机器码之后，可能会增加10%-20%），这就是“时间换空间大法”。</li>
<li>改进CMS 垃圾回收，引入移动垃圾回收器。</li>
<li>ART把Java堆的主要组成包括Image Space、Zygote Space、Allocation Space和Large Object Space四个Space，Image Space用来存在一些预加载的类， Zygote Space和Allocation Space与Dalvik虚拟机垃圾收集机制中的Zygote堆和Active堆的作用是一样的，Large Object Space就是一些离散地址的集合，用来分配一些大对象从而提高了GC的管理效率和整体性能。如图<br><img src="https://upload-images.jianshu.io/upload_images/1534431-56d1ba248844e594.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><h3 id="GC调优思路"><a href="#GC调优思路" class="headerlink" title="GC调优思路"></a>GC调优思路</h3>其中一个或者两个方面的目标，很少有情况可以兼顾三个不同的角度</li>
<li>内存占用 </li>
<li>延时</li>
<li>吞吐量</li>
</ul>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><a href="https://juejin.im/post/5909c7ef570c3500583bf433" target="_blank" rel="external">Android GC 那点事</a></li>
<li><a href="http://jayfeng.com/2016/03/11/%E7%90%86%E8%A7%A3Java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/?from=singlemessage&amp;isappinstalled=0" target="_blank" rel="external">理解Java垃圾回收机制</a><ul>
<li><a href="http://blog.csdn.net/zhengzhb/article/details/7517213" target="_blank" rel="external">Java类生命周期</a></li>
<li><a href="http://blog.csdn.net/zhengzhb/article/details/7331354" target="_blank" rel="external">单例模式讨论篇：单例模式与垃圾回收</a></li>
</ul>
</li>
<li><a href="http://www.importnew.com/26383.html" target="_blank" rel="external">JVM 垃圾回收算法及回收器详解</a></li>
<li><a href="https://blog.csdn.net/antony9118/article/details/51425581" target="_blank" rel="external">为什么新生代内存需要有两个Survivor区</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Java/">Java</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Java基础" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/20/Java基础/" class="article-date">
      <time datetime="2018-06-20T11:30:00.000Z" itemprop="datePublished">2018-06-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/20/Java基础/">Java - Java基础</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><img src="https://upload-images.jianshu.io/upload_images/1534431-82e3766a45c98f7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Java"></p>
<p>###<a href="http://www.importnew.com/6804.html" target="_blank" rel="external">“==”和equals区别</a><br>  “==”是比较的内存地址，equals是Object的方法，默认是比较两个对象内存地址，具体看对象是否重写equals方法。</p>
<p>###<a href="https://www.cnblogs.com/Qian123/p/5703507.html" target="_blank" rel="external">equals和hashCode</a><br>使用Hashset、Hashmap、Hashtable不允许添加重复元素，为了提高效率首先判断元素生成的hashcode()是否相同，如果生成的hashCode()不同在判断equls()方法。</p>
<p>###String、StringBuffer与StringBuilder<br>||线程安全|序列化|默认长度|增长倍数|<br>|-|-|-|-|-|<br>|String|线程安全|支持序列化|0|-|<br>|StringBuffer|线程安全|支持序列化|16|2n+2|<br>|StringBuilder|线程不安全|支持序列化|16|2n+2|</p>
<p>###List子类<br>| List | 实现 | 默认容器大小  | 容量扩充 | 线程是否安全 | 元素是否可以为null |是否支持序列化|优势|<br>| —– | —– | —– | —– | —– | —– | —– | —– |<br>| Vector | 数组实现 | 10  | 2倍 | 安全 | 可以 |否|已经基本不再使用|<br>| ArrayList | 数组实现 | 10  | 2倍 | 不安全 | 可以 |是|查找效率高，插入或删除元素效率低|<br>| LinkedList | 双向循环链表 | 0  | 不需要扩容 | 不安全 | 可以 |是|插入删除效率高，查找效率低|</p>
<p>###Set子类</p>
<p>###Map子类<br>| Map | 实现 | 默认容器大小  | 容量扩充 | 线程是否安全 | 元素是否可以为null |是否支持序列化|优势|<br>| —– | —– | —– | —– | —– | —– | —– | —– |<br>| <a href="https://github.com/francistao/LearningNotes/blob/master/Part2/JavaSE/HashMap源码剖析.md" target="_blank" rel="external">HashMap</a> | 哈希表实现的 | 16  | 2倍| 不安全 |key和value都允许为null，如果key为null，则直接从哈希表的第一个位置table[0]对应的链表上查找。记住，key为null的键值对永远都放在以table[0]为头结点的链表中，当然不一定是存放在头结点table[0]中, |支持|如果单链表中存在与目标key相等的键值对，则将新的value覆盖旧的value|<br>| LinkedHashMap | 哈希表实现的 | 16  | 2倍 | 不安全 | 不可以 |支持||<br>| Hashtable | 哈希表实现的 | 16  | 2倍+1 | 安全 | key可以为null，value不允许为null |支持||</p>
<p>###int-char-long各占多少字节数</p>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">位数</th>
<th style="text-align:left">字节</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">byte</td>
<td style="text-align:left">8</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">char</td>
<td style="text-align:left">16</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">short</td>
<td style="text-align:left">16</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">int</td>
<td style="text-align:left">32</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">long</td>
<td style="text-align:left">64</td>
<td style="text-align:left">8</td>
</tr>
<tr>
<td style="text-align:left">float</td>
<td style="text-align:left">32</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">double</td>
<td style="text-align:left">64</td>
<td style="text-align:left">8</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://yuweiguocn.github.io/java-annotation-processor/" target="_blank" rel="external">自定义Java注解处理器</a></li>
<li><p><a href="http://wiki.jikexueyuan.com/project/java-design-pattern/factory-pattern.html" target="_blank" rel="external">Java 23种设计模式</a></p>
<ul>
<li>单例模式</li>
<li><p><a href="http://wiki.jikexueyuan.com/project/java-design-pattern/factory-pattern.html" target="_blank" rel="external">工厂模式</a></p>
<ol>
<li><a href="http://www.cnblogs.com/lcw/p/3802790.html" target="_blank" rel="external">静态工厂模式</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/java-design-pattern/factory-pattern.html" target="_blank" rel="external">工厂方法模式</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/java-design-pattern/abstract-factory-pattern.html" target="_blank" rel="external">抽象工厂模式</a></li>
<li>区别：<blockquote>
<p>静态工厂模式:用静态方法获取指定产品<br>   工厂方法模式:定义工厂接口,一个方法,让不同的子类工厂生产指定产品<br>   抽象工厂模式:同工厂方法模式类似,只是工厂接口有多个方法</p>
</blockquote>
</li>
</ol>
</li>
<li><p>建造者模式</p>
</li>
<li>代理模式</li>
<li>策略模式</li>
<li>模板模式</li>
<li>观察者模式</li>
</ul>
</li>
</ul>
<h4 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h4><ul>
<li><a href="http://blog.csdn.net/bjyfb/article/details/6682913" target="_blank" rel="external">HTTP,TCP,Socket关系</a><ul>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzA4MzQxMzg5MA==&amp;mid=2649830415&amp;idx=2&amp;sn=760da2138f07c96ef25d451d745c4c72&amp;scene=0#wechat_redirect" target="_blank" rel="external">TCP和UDP区别？TCP几次握手，几次断开？</a></li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Java/">Java</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Android各个版本新特性" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/06/Android各个版本新特性/" class="article-date">
      <time datetime="2018-06-06T14:58:29.000Z" itemprop="datePublished">2018-06-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/06/Android各个版本新特性/">Android各个版本新特性</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>目前主流的Android适配版本最低版本4.0或5.0，这里主要总结一下Android 4.0以后各个版本特性，方便适配和面试。加粗标注为面试中问到的重点特性，其他为重要适配特性。（倒序）</p>
<ul>
<li><a href="https://developer.android.google.cn/about/versions/oreo/android-8.0.html" target="_blank" rel="external">Android 8.0</a><ul>
<li>优化通知<ul>
<li>通知渠道</li>
<li>通知标志</li>
<li>休眠</li>
<li>通知超时</li>
<li>通知设置</li>
<li>通知清除</li>
</ul>
</li>
<li>自动填充框架</li>
<li>画中画模式：清单中Activity设置android:supportsPictureInPicture</li>
<li><strong>可下载字体</strong>：<a href="https://developer.android.google.cn/reference/android/provider/FontsContract.html" target="_blank" rel="external">FontRequest</a></li>
<li><a href="https://developer.android.google.cn/guide/topics/ui/look-and-feel/fonts-in-xml.html" target="_blank" rel="external">XML 中的字体</a></li>
<li><strong>自动调整 TextView 的大小</strong></li>
<li><a href="https://developer.android.google.cn/guide/practices/ui_guidelines/icon_design_adaptive.html" target="_blank" rel="external">自适应图标</a></li>
<li>颜色管理</li>
<li><a href="https://developer.android.google.cn/guide/webapps/managing-webview.html" target="_blank" rel="external">WebView API</a></li>
<li>多显示器支持</li>
<li><strong>统一的布局外边距和内边距</strong><br><img src="http://upload-images.jianshu.io/upload_images/1534431-b4ba4d688a817290.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
<li>指针捕获</li>
<li>应用类别</li>
<li>Android TV 启动器</li>
<li>AnimatorSet</li>
<li><strong>新的 StrictMode 检测程序</strong><br><img src="http://upload-images.jianshu.io/upload_images/1534431-e33af7003dde9550.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
<li>缓存数据</li>
<li><strong>findViewById() 签名变更</strong><br><img src="http://upload-images.jianshu.io/upload_images/1534431-89c0141aa910db0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
<li><strong>权限</strong><br><img src="http://upload-images.jianshu.io/upload_images/1534431-f4c146ef0be3c03f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
<li><strong>更新的 Java 支持</strong><br><img src="http://upload-images.jianshu.io/upload_images/1534431-0464c897b3051935.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ul>
</li>
</ul>
<ul>
<li><a href="https://developer.android.google.cn/about/versions/nougat/android-7.1.html" target="_blank" rel="external">Android 7.1</a><ul>
<li>加入重启按钮</li>
<li>App圆形图标</li>
<li>添加新的Emoji</li>
</ul>
</li>
<li><a href="https://developer.android.google.cn/about/versions/nougat/android-7.0-changes.html" target="_blank" rel="external">Android 7.0</a><ul>
<li>电池和内存<ul>
<li>低电耗模式</li>
<li>Project Svelte：后台优化</li>
</ul>
</li>
<li><strong>权限更改</strong><ul>
<li>系统权限更改</li>
</ul>
</li>
<li><strong>在应用间文件共享权限控制</strong></li>
<li><strong>多窗口支持</strong></li>
<li><strong>通知栏快捷回复</strong></li>
<li><strong>支持VR</strong></li>
<li>引入JIT编译器</li>
<li><strong>画中画</strong></li>
<li><strong>App快捷菜单</strong></li>
</ul>
</li>
<li><a href="https://developer.android.google.cn/about/versions/marshmallow/android-6.0-changes.html" target="_blank" rel="external">Android 6.0</a><ul>
<li><strong>运行时请求权限</strong></li>
<li>低电耗模式和应用待机模式</li>
<li><strong>取消支持 Apache HTTP 客户端</strong></li>
<li>BoringSSL</li>
<li>硬件标识符访问权</li>
<li>通知</li>
<li>音频管理器变更</li>
<li><strong>支持文本选择</strong></li>
<li>Android 密钥库不再支持 DSA。但仍支持 ECDSA</li>
<li>WLAN 和网络连接变更</li>
<li>相机服务变更</li>
<li>APK 验证</li>
<li>USB 连接</li>
</ul>
</li>
<li><a href="https://developer.android.google.cn/about/versions/android-5.0-changes.html#managed_profiles" target="_blank" rel="external">Android 5.0</a><ul>
<li><strong>Android Runtime (ART)默认运行平台设置</strong></li>
<li><strong>通知</strong><pre><code>- Material Design 样式
- 声音和振动
- 锁定屏幕可见性
- 媒体播放
- 浮动通知
</code></pre></li>
<li><strong>引入Material Design设计</strong></li>
<li>支持OpenGL ES3.1 </li>
<li>媒体控件和 RemoteControlClient</li>
<li>getRecentTasks()</li>
<li><strong>支持Android NDK中的64位</strong></li>
<li><strong>只能显示绑定到服务，取消隐藏绑定服务</strong></li>
<li>WebView API修改</li>
<li>自定义权限唯一性要求</li>
<li><strong>TLS/SSL 默认配置变更</strong><pre><code>- 服务器不支持任何已启用的加密套件
- 应用对用于连接服务器的加密套件做出错误的假设
- 服务器不支持 TLSv1.1、TLSv1.2 或新的 TLS 扩展
</code></pre></li>
<li>支持托管配置文件</li>
</ul>
</li>
<li><a href="https://developer.android.google.cn/about/versions/kitkat.html" target="_blank" rel="external">Android 4.4</a><ul>
<li><strong>支持Android Beam</strong></li>
<li><strong>添加打印框架</strong></li>
<li>存储访问框架</li>
<li>低功耗传感器</li>
<li>添加短信提供程序</li>
<li><strong>添加全屏沉浸模式</strong><ul>
<li><a href="http://www.jianshu.com/p/be2b7be418d7#" target="_blank" rel="external">Android 沉浸式状态栏的三种实现方式</a></li>
<li><a href="https://github.com/jgilfelt/SystemBarTint" target="_blank" rel="external">兼容库SystemBarTint</a></li>
</ul>
</li>
<li><strong>添加透明系统 UI 样式</strong></li>
<li>添加新的媒体功能</li>
<li>RenderScript Compute<ul>
<li>持续性能提升</li>
<li><strong>GPU 加速</strong></li>
<li>Android NDK 中的 RenderScript</li>
</ul>
</li>
<li>图形<ul>
<li>GLES2.0 SurfaceFlinge</li>
<li>新的硬件合成器支持虚拟显示</li>
</ul>
</li>
<li>支持新的连接类型<ul>
<li>新的蓝牙配置文件</li>
<li>红外发射器</li>
<li>Wi-Fi TDLS 支持</li>
</ul>
</li>
<li>无障碍功能</li>
<li>安全增强功能</li>
<li>内存使用率分析工具<ul>
<li>Procstats </li>
</ul>
</li>
</ul>
</li>
<li><a href="https://developer.android.google.cn/about/versions/jelly-bean.html" target="_blank" rel="external">Android 4.0,4.1,4.2,4.3</a><ul>
<li>支持OpenGL ES 3.0</li>
<li>增强蓝牙连接</li>
<li>优化位置和传感器</li>
<li><strong>添加转场动画</strong></li>
<li>支持Daydream</li>
<li><strong>人脸识别解锁</strong></li>
<li><strong>Photo Sphere 全景相片</strong></li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Android兼容包调用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/13/Android兼容包调用/" class="article-date">
      <time datetime="2017-11-13T01:58:52.169Z" itemprop="datePublished">2017-11-13</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Android与iOS开发统一坑"><a href="#Android与iOS开发统一坑" class="headerlink" title="Android与iOS开发统一坑"></a>Android与iOS开发统一坑</h2><h3 id="时间搓"><a href="#时间搓" class="headerlink" title="时间搓"></a>时间搓</h3><ul>
<li>Java取时间戳为13位</li>
<li>iOS取时间戳10位</li>
<li>解决方案：统一用13位，后台Java写的，其他平台调用都是以13位取<h3 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h3></li>
<li>Android下拉刷新View没有偏移</li>
<li>iOS下拉刷新有偏移</li>
<li>解决方案:下拉有偏移体验更好，Android重新写view，根据移动偏移计算偏移位置，github有很多成型的项目</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-long-long用什么保存数据" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/08/31/long-long用什么保存数据/" class="article-date">
      <time datetime="2017-08-31T08:38:45.000Z" itemprop="datePublished">2017-08-31</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="long-long用什么保存数据"><a href="#long-long用什么保存数据" class="headerlink" title="long*long用什么保存数据"></a>long*long用什么保存数据</h2><ul>
<li><p>前言</p>
<ul>
<li><p>突然想起一个问到的面试题：</p>
 <figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">问：<span class="keyword">int</span>*<span class="keyword">int</span>你用什么数据保存？</div><div class="line">答：用<span class="keyword">long</span></div><div class="line">问：那<span class="keyword">long</span>*<span class="keyword">long</span>用什么数据保存？</div><div class="line">答：应该用<span class="keyword">String</span>吧</div><div class="line">后面就没有结果</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>其实主要考的int或者long超过了他最多长度你该什么保存数据，这主要后台计算大金额或者大数据的时候会用到。可是问道我这个Android移动开发的，懵逼了。那答案是什么了–&gt;BigDecimal</p>
<ul>
<li><p><a href="https://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html" target="_blank" rel="external">BigDecimal    </a></p>
<ul>
<li>一般的float型和Double型数据只可以用来做科学计算或者是工程计算，对精度要求不高。但是在商业计算中，要求的数字精度比较高Java提供了BigDecimal来解决精度不高问题。</li>
<li><p>先看例子就知道为什么用BigDecimal了</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	<span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BigTests</span> &#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"1111111111 * 1111111111="</span> + <span class="number">1111111111</span> * <span class="number">1111111111</span>);</div><div class="line">        BigDecimal bigDecimal = BigDecimal.valueOf(<span class="number">1111111111</span>);</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"BigDecimal.valueOf(1111111111) * BigDecimal.valueOf(1111111111)="</span> + bigDecimal.multiply(bigDecimal).toString());</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11111111.111 * 11111111.111="</span> + <span class="number">11111111.111</span> * <span class="number">11111111.111</span>);</div><div class="line">        BigDecimal longDecimal = BigDecimal.valueOf(<span class="number">11111111.111</span>);</div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"BigDecimal.valueOf(11111111.111) * BigDecimal.valueOf(11111111.111)="</span> + longDecimal.multiply(longDecimal).toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	<span class="number">1111111111</span> * <span class="number">1111111111</span>=<span class="number">91750577</span></div><div class="line">BigDecimal.valueOf(<span class="number">1111111111</span>) * BigDecimal.valueOf(<span class="number">1111111111</span>)=<span class="number">1234567900987654321</span></div><div class="line"><span class="number">11111111.111</span> * <span class="number">11111111.111</span>=<span class="number">1.2345679012098764E14</span></div><div class="line">BigDecimal.valueOf(<span class="number">11111111.111</span>) * BigDecimal.valueOf(<span class="number">11111111.111</span>)=<span class="number">123456790120987.654321</span></div></pre></td></tr></table></figure>
<p>很明显通过BigDecimal计算的结果才是正确的计算结果。那我们就知道大数据计算需要用BigDecimal处理了，那也就有两个问题了：</p>
</li>
<li><p>long为什么计算的结果是错误的？</p>
</li>
<li>BigDecimal是怎么实现计算的？</li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Jenkins配置Android深坑" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/17/Jenkins配置Android深坑/" class="article-date">
      <time datetime="2017-07-17T09:47:29.000Z" itemprop="datePublished">2017-07-17</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/17/Jenkins配置Android深坑/">Jenkins配置Android深坑</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在Jenkins上配置Android的一些持续集成（自动打包上传，单元测试，集成测试等）应该是很普遍的事情了。Jenkins一般配置在一个通用的测试服务器上，原来都是拿一个mac当测试服务器，在上面想怎么玩怎么就怎么玩，想怎么配置就怎么配置。可是如果测试服务器是在虚拟机上而且测试服务器不是你能控制的，那就要在Jenkins上配置Android就不能想自己控制自己电脑那边方便了，在配置过程中也填了不少的坑。那就讲下填坑之路吧。</p>
<h4 id="Jenkins安装"><a href="#Jenkins安装" class="headerlink" title="Jenkins安装"></a>Jenkins安装</h4><p> 这部分一般不用担心，在公司里会有专门的人员安装，你只管用就可以了。那如果是由你负责安装Jenkins的话那就要好好看Jenkins官网的安装方法了，<a href="https://jenkins.io/download/" target="_blank" rel="external">根据不同的平台下载不同的安装包安装</a></p>
<h4 id="Jenkins上新建项目"><a href="#Jenkins上新建项目" class="headerlink" title="Jenkins上新建项目"></a>Jenkins上新建项目</h4><p>在打开的Jenkins页面左上方找到”创建”(create),<br><img src="http://upload-images.jianshu.io/upload_images/1534431-cbd759e33b51c05c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>然后，写项目名和项目类型</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-031ffec2a56338d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(因为是Android项目，默认就选择第一个。)<br>然后选择”OK”<br>然后,一个新建的项目就好了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-f3da863f34edd75e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Jenkins配置项目"><a href="#Jenkins配置项目" class="headerlink" title="Jenkins配置项目"></a>Jenkins配置项目</h4><p>配置前提条件就是你<a href="https://jenkins.io/doc/book/managing/plugins/" target="_blank" rel="external">jenkins要安装好几个插件</a>: git插件，gradle插件，Android虚拟机插件<br><img src="http://upload-images.jianshu.io/upload_images/1534431-d563fd7f6289c76a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="http://upload-images.jianshu.io/upload_images/1534431-630008664ec0e4df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="http://upload-images.jianshu.io/upload_images/1534431-096e22f8f71b8d9f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>然后就开始<br><a href="https://www.zuehlke.com/blog/en/configure-your-android-project-on-jenkins/" target="_blank" rel="external">Jenkins官网配置Androd环境</a>，</p>
<ul>
<li>选择JDK</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-8dc9b1da00eb9751.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>源码</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-5d5da1a0efcb3f73.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>构建环境</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-0652ce7865dadf45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png">虚拟机配置后期关闭，配置虚拟机主要用来下载andoid-sdk。</p>
<ul>
<li>构建</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-a430e352881caaaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>OK,好了，这就是正确的配置，那我们就运行下开始深坑之旅了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-f199552ec5263663.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>看下输入log</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-dcdc202bcd339294.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>####问题不分先后，按解决问题处理</p>
<ul>
<li>问题1</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-fe1cf269790bc480.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>虚拟机没有找到相应的hardware配置，尝试更改各种配置方法最后都是失败结束（如果你有其他解决方法记得告诉我）。能走到这一步就说明你的andoid-sdk已经按照好了，只是打开虚拟机还有问题。想想本身主要用来gradle打包Android apk，还用不到打开虚拟机，能安装好Android-sdk就可以。然后在项目配置中![Alt text]<br><img src="http://upload-images.jianshu.io/upload_images/1534431-1dee90179b1159f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>勾选掉虚拟机配置就可以了，不影响你gradle打包。</p>
<ul>
<li>问题2</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-459d738485a45673.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>Android环境变量没有配置，需要根据Android虚拟机配置下载来的android sdk位置配了，</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-5c08d301ca0b3962.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>仔细看下android虚拟机下载sdk的位置，然后在jenkins的系统配置中配置相应的环境变量<br><img src="http://upload-images.jianshu.io/upload_images/1534431-d1dcc03ef8d1b69c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>就可以了。</p>
<ul>
<li>问题3</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-5e890bdc058bdc5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>虚拟机的ABIs没有配置好,需要项目配置</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-067d2f34dbe6ae82.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>就OK了。</p>
<ul>
<li>问题4<br><img src="http://upload-images.jianshu.io/upload_images/1534431-42d5c68603b71397.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>这个是说你下载的android-sdk需要同意协议，可是我们这个是虚拟的服务器上没有办法点击同意啊，那就看提示解决方法地址</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-385369d144163db1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-3d0e78dbf20fe800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>有两种解决方案，一种在ui上点，一种是把你已经同意好的协议文件拷贝到当前页面。那我们只能把自己电脑的电脑拷贝进去了，可是又遇到问题，我没有权限访问这个服务器那怎么复制到这个jekins服务器上了，那只能把这个协议文件上传到<a href="https://www.qiniu.com/" target="_blank" rel="external">七牛</a>（或者其他托管服务器上），脚本如下<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 进入下载好的android-sdk路径</span></div><div class="line">cd /root/.jenkins/tools/android-sdk</div><div class="line"><span class="meta"># 新建协议文件夹</span></div><div class="line">mkdir licenses</div><div class="line"><span class="meta"># 进入协议文件夹内</span></div><div class="line">cd /root/.jenkins/tools/android-sdk/licenses</div><div class="line"><span class="meta"># rm -rf android-sdk-license</span></div><div class="line"><span class="meta"># 下载已经同意好的android协议文件</span></div><div class="line">wget http:<span class="comment">//7xn0ue.com1.z0.glb.clouddn.com/android-sdk-license</span></div></pre></td></tr></table></figure></p>
<p>具体项目配置</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-da840093cfec03e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>OK,重新构建一下，不过记得先把“构建环境”的配置勾选掉，要不然“构建环境有问题执行不到这个脚本”</p>
<ul>
<li>问题5</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-82183912bc907638.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>你运行的系统缺少libGL.so.1库，那就需要安装这个库，找了下可以用<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">yum install mesa-libGL -y</div><div class="line">```脚本解决,已经要记得加“-y ”要不然会出错提示</div><div class="line"></div><div class="line">![image.png](http:<span class="comment">//upload-images.jianshu.io/upload_images/1534431-23a8a172c18ff124.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span></div><div class="line"></div><div class="line"></div><div class="line">- 问题<span class="number">6</span></div><div class="line"></div><div class="line">![image.png](http:<span class="comment">//upload-images.jianshu.io/upload_images/1534431-570f151c6e7b1551.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span></div><div class="line"></div><div class="line">你运行的系统内核版本过低需要升级，这个也是我比较纠结的要是升级那会不会影响测试服务器的运行。（如果你现在是正式环境下你就需要跟领导沟通只是斟酌了）。</div><div class="line">通过以下脚本可以解决，同</div></pre></td></tr></table></figure></p>
<h1 id="下载glibc-2-15-tar-gz内核文件，根据不同版本在http-ftp-gnu-org-gnu-glibc"><a href="#下载glibc-2-15-tar-gz内核文件，根据不同版本在http-ftp-gnu-org-gnu-glibc" class="headerlink" title="下载glibc-2.15.tar.gz内核文件，根据不同版本在http://ftp.gnu.org/gnu/glibc/"></a>下载glibc-2.15.tar.gz内核文件，根据不同版本在<a href="http://ftp.gnu.org/gnu/glibc/" target="_blank" rel="external">http://ftp.gnu.org/gnu/glibc/</a></h1><p>下载<br>wget <a href="http://ftp.gnu.org/gnu/glibc/glibc-2.15.tar.gz" target="_blank" rel="external">http://ftp.gnu.org/gnu/glibc/glibc-2.15.tar.gz</a></p>
<h1 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h1><p>tar -xvf glibc-2.15.tar.gz</p>
<h1 id="依赖库-glibc-ports-2-15-tar-gz"><a href="#依赖库-glibc-ports-2-15-tar-gz" class="headerlink" title="依赖库(glibc-ports-2.15.tar.gz)"></a>依赖库(glibc-ports-2.15.tar.gz)</h1><p>wget <a href="http://ftp.gnu.org/gnu/glibc/glibc-ports-2.15.tar.gz" target="_blank" rel="external">http://ftp.gnu.org/gnu/glibc/glibc-ports-2.15.tar.gz</a></p>
<h1 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h1><p>tar -xvf glibc-ports-2.15.tar.gz</p>
<h1 id="依赖库解压目录移到到主目录中"><a href="#依赖库解压目录移到到主目录中" class="headerlink" title="依赖库解压目录移到到主目录中"></a>依赖库解压目录移到到主目录中</h1><p>mv glibc-ports-2.15 glibc-2.15/ports</p>
<h1 id="创建编译目录"><a href="#创建编译目录" class="headerlink" title="创建编译目录"></a>创建编译目录</h1><p>mkdir glibc-build<br>cd glibc-build</p>
<h1 id="运行以下命令编译及安装"><a href="#运行以下命令编译及安装" class="headerlink" title="运行以下命令编译及安装"></a>运行以下命令编译及安装</h1><p>../glibc-2.15/configure –prefix=/usr –disable-profile –enable-add-ons –with-headers=/usr/include –with-binutils=/usr/bin<br>make<br>make install<br>```<br>配置如下<br><img src="http://upload-images.jianshu.io/upload_images/1534431-f5153e0d9295fde4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>以上是我遇到的所有问题，希望这些坑可以对你有帮助。<br>那看下最后成功输出log和配置：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-5a7844d2a0ded788.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="log"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-1e5e1234553f21e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="JDK"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-adb38281522b4c42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="源码仓库"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-f59eff5b1878425c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="构建触发器和构建环境"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1534431-7705c3fbf55d287f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="构建"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/其他/">其他</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Android使用枚举正确姿态" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/20/Android使用枚举正确姿态/" class="article-date">
      <time datetime="2017-06-19T18:30:29.000Z" itemprop="datePublished">2017-06-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/20/Android使用枚举正确姿态/">Android使用枚举正确姿态</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <ul>
<li><p><a href="https://developer.android.com/topic/performance/memory.html" target="_blank" rel="external">大家应该都知道Android建议不要用Java枚举，它占用内存很大</a><br><img src="http://static.codeceo.com/images/2015/08/0F3D1FC7-6CFC-41D7-9A43-C9A9C9DD45D5.jpg" alt="图片"></p>
<p>那实际开发中肯定是要用Java枚举的，那有没有什么解决办法了。答案肯定是有的，<a href="https://developer.android.com/reference/android/support/annotation/StringDef.html" target="_blank" rel="external">只是换成另外一种方式</a></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">/**</span></div><div class="line"> * Android枚举</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestEnum &#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * @Retention(RetentionPolicy.SOURCE) 注解可以告知编译器不将枚举的注解数据存储在 .class 文件中</div><div class="line">     *</div><div class="line">     */</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * @StringDef创建整型和字符串集的枚举注解来验证其他类型的代码引用</div><div class="line">     * 具体详细看官网&#123;@link https://developer.android.com/studio/write/annotations.html?hl=zh-cn#adding-annotations&#125;</div><div class="line">     */</div><div class="line">    <span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</div><div class="line">    <span class="meta">@StringDef</span>(&#123;</div><div class="line">            POWER_SERVICE,</div><div class="line">            WINDOW_SERVICE,</div><div class="line">            LAYOUT_INFLATER_SERVICE</div><div class="line">    &#125;)</div><div class="line">    <span class="comment">//@interface这是Java用来定义一个注解类。</span></div><div class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> ServiceName &#123;&#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="built_in">String</span> POWER_SERVICE = <span class="string">"power"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="built_in">String</span> WINDOW_SERVICE = <span class="string">"window"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="built_in">String</span> LAYOUT_INFLATER_SERVICE = <span class="string">"layout_inflater"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">String</span> getSystemService(<span class="meta">@ServiceName</span> <span class="built_in">String</span> name) &#123;</div><div class="line">        <span class="keyword">if</span> (POWER_SERVICE.equals(name)) &#123;</div><div class="line">            <span class="keyword">return</span> POWER_SERVICE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (WINDOW_SERVICE.equals(name)) &#123;</div><div class="line">            <span class="keyword">return</span> WINDOW_SERVICE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LAYOUT_INFLATER_SERVICE.equals(name)) &#123;</div><div class="line">            <span class="keyword">return</span> LAYOUT_INFLATER_SERVICE;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> main(<span class="built_in">String</span>[] args) &#123;</div><div class="line">        <span class="comment">//使用</span></div><div class="line">System.out.println(TestEnum.getSystemService(TestEnum.LAYOUT_INFLATER_SERVICE));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这就是官网的写法了。可是发现没有每次传的参数是</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">TestEnum</span><span class="selector-class">.LAYOUT_INFLATER_SERVICE</span></div><div class="line">或者</div><div class="line"><span class="selector-tag">TestEnum</span><span class="selector-class">.POWER_SERVICE</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>  而不是像我们Java枚举的传参</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">ServiceName</span><span class="selector-class">.LAYOUT_INFLATER_SERVICE</span></div></pre></td></tr></table></figure>
<p>  那是不是需要改造下。<a href="https://stackoverflow.com/questions/35625247/android-is-it-ok-to-put-intdef-values-inside-interface" target="_blank" rel="external">查看资料</a>可以这样写</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Android枚举</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestEnum &#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * @Retention(RetentionPolicy.SOURCE) 注解可以告知编译器不将枚举的注解数据存储在 .class 文件中</div><div class="line">     *</div><div class="line">     */</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * @StringDef创建整型和字符串集的枚举注解来验证其他类型的代码引用 具体详细看官网&#123;@link https://developer.android.com/studio/write/annotations.html?hl=zh-cn#adding-annotations&#125;</div><div class="line">     */</div><div class="line">    <span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</div><div class="line">    <span class="meta">@StringDef</span>(&#123;</div><div class="line">            ServiceName.POWER_SERVICE,</div><div class="line">            ServiceName.WINDOW_SERVICE,</div><div class="line">            ServiceName.LAYOUT_INFLATER_SERVICE</div><div class="line">    &#125;)</div><div class="line">    <span class="comment">//@interface这是Java用来定义一个注解类。</span></div><div class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> ServiceName &#123;</div><div class="line">        <span class="built_in">String</span> POWER_SERVICE = <span class="string">"power"</span>;</div><div class="line">        <span class="built_in">String</span> WINDOW_SERVICE = <span class="string">"window"</span>;</div><div class="line">        <span class="built_in">String</span> LAYOUT_INFLATER_SERVICE = <span class="string">"layout_inflater"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">String</span> getSystemService(<span class="meta">@ServiceName</span> <span class="built_in">String</span> name) &#123;</div><div class="line">        <span class="keyword">if</span> (ServiceName.POWER_SERVICE.equals(name)) &#123;</div><div class="line">            <span class="keyword">return</span> ServiceName.POWER_SERVICE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ServiceName.WINDOW_SERVICE.equals(name)) &#123;</div><div class="line">            <span class="keyword">return</span> ServiceName.WINDOW_SERVICE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ServiceName.LAYOUT_INFLATER_SERVICE.equals(name)) &#123;</div><div class="line">            <span class="keyword">return</span> ServiceName.LAYOUT_INFLATER_SERVICE;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> main(<span class="built_in">String</span>[] args) &#123;</div><div class="line">        <span class="comment">//使用</span></div><div class="line">        System.out.println(TestEnum.getSystemService(ServiceName.LAYOUT_INFLATER_SERVICE));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不错，就是把常量放到里面去了。这个时候差不多好了，怎么看</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public static String getSystemService(@ServiceName String <span class="built_in">name</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (ServiceName.POWER_SERVICE.<span class="keyword">equals</span>(<span class="built_in">name</span>)) &#123;</div><div class="line"><span class="built_in">            return</span> ServiceName.POWER_SERVICE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ServiceName.WINDOW_SERVICE.<span class="keyword">equals</span>(<span class="built_in">name</span>)) &#123;</div><div class="line"><span class="built_in">            return</span> ServiceName.WINDOW_SERVICE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ServiceName.LAYOUT_INFLATER_SERVICE.<span class="keyword">equals</span>(<span class="built_in">name</span>)) &#123;</div><div class="line"><span class="built_in">            return</span> ServiceName.LAYOUT_INFLATER_SERVICE;</div><div class="line">        &#125;</div><div class="line"><span class="built_in">        return</span> null;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这个代码还是有点怪怪的，在Java中可以通过enum.values()获取所有enum的值，找了好像没有只能通过反射获取所有的public的参数和参数值了</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSystemService</span>(<span class="params">@ServiceName String name</span>) </span>&#123;</div><div class="line">        Field[] fields = ServiceName.class.getDeclaredFields();</div><div class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</div><div class="line">            <span class="comment">//在反射对象中设置 accessible 标志允许具有足够特权的复杂应用程序（比如 Java Object Serialization 或其他持久性机制）以某种通常禁止使用的方式来操作对象</span></div><div class="line">            field.setAccessible(<span class="literal">true</span>);</div><div class="line">            String <span class="keyword">value</span> = <span class="literal">null</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">value</span> = String.valueOf(field.<span class="keyword">get</span>(field.getName()));</div><div class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> != <span class="literal">null</span> &amp;&amp; <span class="keyword">value</span>.<span class="keyword">equals</span>(name)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">value</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ok完成，<a href="https://github.com/mysiga/TestProject/blob/master/app/src/main/java/com/mysiga/testproject/TestEnum.java" target="_blank" rel="external">代码地址</a></p>
<p>这里有几个知识点参考资料链接看下</p>
<ul>
<li><a href="@Retention">@Retention</a></li>
<li><a href="https://developer.android.com/reference/android/support/annotation/StringDef.html?hl=zh-cn" target="_blank" rel="external">@StringDef</a></li>
<li><a href="http://www.cnblogs.com/bingoidea/archive/2011/03/31/2000726.html" target="_blank" rel="external">@interface</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/java-reflection/java-classes.html" target="_blank" rel="external">Java反射</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-推荐博文" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/11/推荐博文/" class="article-date">
      <time datetime="2017-06-11T09:29:29.000Z" itemprop="datePublished">2017-06-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/11/推荐博文/">推荐博文</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <ul>
<li>Java<ul>
<li><a href="http://www.importnew.com/14229.html" target="_blank" rel="external">Java中有关Null的9件事</a></li>
</ul>
</li>
<li>Android<br>-<a href="http://gold.xitu.io/entry/577bae93d342d30057970e05" target="_blank" rel="external">Android组件化和插件化开发</a></li>
<li>其他<ul>
<li><a href="http://www.36dsj.com/archives/39775" target="_blank" rel="external">重磅！神经网络浅讲：从神经元到深度学习</a></li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/其他/">其他</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2018 Wilson
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>